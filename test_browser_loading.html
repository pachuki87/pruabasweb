<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Course Loading</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Test de Carga de Curso</h1>
    <div id="results"></div>
    <button onclick="testCourseLoading()">Probar Carga</button>
    
    <script>
        // Configuración de Supabase (usando variables de entorno simuladas)
        const SUPABASE_URL = 'https://ixjqvkqvwqhqhqhqhqhq.supabase.co'; // Placeholder
        const SUPABASE_ANON_KEY = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9'; // Placeholder
        
        // Nota: En producción, estas variables vendrían del .env
        // Para este test, necesitaremos las variables reales
        
        function log(message, isError = false) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.style.color = isError ? 'red' : 'green';
            div.style.margin = '5px 0';
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }
        
        async function testCourseLoading() {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            log('🔍 Iniciando test de carga de curso...');
            
            try {
                // Simular el mapeo de curso
                const rawCourseId = 'master-adicciones';
                const mapCourseSlugToId = (slug) => {
                    const courseMapping = {
                        'master-adicciones': 'b5ef8c64-fe26-4f20-8221-80a1bf475b05',
                        'experto-conductas-adictivas': 'd7c3e503-ed61-4d7a-9e5f-aedc407d4836'
                    };
                    return courseMapping[slug] || slug;
                };
                
                const courseId = mapCourseSlugToId(rawCourseId);
                log(`✅ Curso mapeado: ${rawCourseId} -> ${courseId}`);
                
                // Aquí necesitaríamos las credenciales reales de Supabase
                log('⚠️ Para completar el test, necesitamos las credenciales reales de Supabase');
                log('📝 Verificar que las variables VITE_SUPABASE_URL y VITE_SUPABASE_ANON_KEY estén correctas');
                
                // Simular el proceso de carga
                log('🔄 Simulando proceso de carga...');
                
                // Test de localStorage y sessionStorage
                try {
                    localStorage.setItem('test', 'value');
                    sessionStorage.setItem('test', 'value');
                    log('✅ LocalStorage y SessionStorage funcionan');
                } catch (e) {
                    log('❌ Error con Storage: ' + e.message, true);
                }
                
                // Test de fetch API
                try {
                    const response = await fetch('https://httpbin.org/json');
                    if (response.ok) {
                        log('✅ Fetch API funciona');
                    } else {
                        log('❌ Fetch API error: ' + response.status, true);
                    }
                } catch (e) {
                    log('❌ Error de red: ' + e.message, true);
                }
                
                // Test de console y errores
                log('✅ Console.log funciona');
                
                // Simular error típico
                try {
                    throw new Error('Test error');
                } catch (e) {
                    log('✅ Manejo de errores funciona: ' + e.message);
                }
                
                log('🏁 Test básico completado');
                
            } catch (error) {
                log('❌ Error en test: ' + error.message, true);
                console.error('Error completo:', error);
            }
        }
        
        // Auto-ejecutar al cargar
        window.addEventListener('load', () => {
            log('📱 Página cargada, listo para probar');
        });
    </script>
</body>
</html>